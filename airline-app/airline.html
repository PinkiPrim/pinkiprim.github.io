<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TT Airline Ops v1.1</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;900&family=Roboto:wght@400;700&display=swap');

        :root {
            --primary: #03a9f4; 
            --primary-dim: #0277bd;
            --bg-glass: rgba(18, 18, 18, 0.95);
            --bg-dark: rgba(10, 10, 10, 0.98);
            --text-main: #ffffff;
            --text-dim: #aaaaaa;
            --border: 1px solid rgba(3, 169, 244, 0.3);
            --green: #00e676;
            --orange: #ff9800;
            --red: #ff5252;
            --accent: #81d4fa;
            --gold: #ffd700;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: transparent;
            color: var(--text-main);
            overflow: hidden;
            height: 100vh; width: 100vw;
            user-select: none;
        }

        #tracker-app {
            position: absolute;
            top: 50px; left: 50px;
            width: 320px;
            background: var(--bg-glass);
            border: var(--border);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            overflow: hidden;
            transition: width 0.2s ease, height 0.2s ease;
            min-height: 250px;
        }

        /* --- MINI MODE --- */
        #tracker-app.mini-mode {
            width: 420px !important; height: 74px !important;
            min-height: 74px !important; border-radius: 12px;
            background: var(--bg-dark); border: 1px solid var(--primary);
            resize: none;
        }
        #tracker-app.mini-mode header, 
        #tracker-app.mini-mode #sky-container, 
        #tracker-app.mini-mode #content,
        #tracker-app.mini-mode #grinder-panel { display: none !important; }

        #micro-view {
            display: none; flex-direction: column; justify-content: center;
            height: 100%; padding: 0 12px; font-family: 'Rajdhani', sans-serif; cursor: move;
        }
        #tracker-app.mini-mode #micro-view { display: flex; }

        .micro-row { display: flex; justify-content: space-between; align-items: center; width: 100%; height: 50%; }
        .micro-group { display: flex; align-items: center; gap: 8px; }
        .micro-sep { width: 1px; height: 12px; background: rgba(255,255,255,0.2); }
        .micro-label { color: var(--text-dim); font-size: 0.75em; text-transform: uppercase; letter-spacing: 1px; }
        .micro-val { color: #fff; font-weight: 700; font-size: 0.9em; }
        .micro-val.highlight { color: var(--primary); }
        .micro-val.active { color: var(--green); }
        .micro-val.urgent { color: var(--red); }
        
        .micro-progress-bg { width: 60px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin: 0 5px; }
        .micro-progress-fill { height: 100%; background: var(--primary); width: 0%; }

        .micro-btn {
            position: absolute; top: 4px; right: 4px;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: #aaa; padding: 0px 4px; border-radius: 3px; 
            font-size: 0.6em; cursor: pointer; text-transform: uppercase;
        }
        .micro-btn:hover { background: var(--primary); color: white; }

        /* --- HEADER --- */
        header {
            background: linear-gradient(180deg, var(--primary-dim), rgba(3, 169, 244, 0.2));
            height: 65px; padding: 0 10px; cursor: move; position: relative;
            display: flex; align-items: flex-start; justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.15); overflow: visible; padding-top: 5px; z-index: 20;
        }

        .header-title {
            position: absolute; left: 50%; top: 25%; transform: translate(-50%, -50%);
            font-family: 'Rajdhani', sans-serif; font-weight: 900; font-size: 1.2em;
            text-transform: uppercase; letter-spacing: 2px; color: #fff; pointer-events: none; white-space: nowrap;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 10;
        }

        #user-name-fly {
            position: absolute; top: 38px; left: 50%; transform: translateX(-50%);
            font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.95em;
            color: #fff; white-space: nowrap; pointer-events: none; z-index: 10;
            text-shadow: 0 0 5px var(--primary);
        }

        /* BURGER MENU */
        .menu-container { position: relative; }
        .burger-btn {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2);
            color: #fff; font-size: 1.2em; padding: 4px 8px; border-radius: 4px; cursor: pointer;
        }
        .burger-btn:hover { background: var(--primary); color: black; }

        .dropdown-menu {
            position: absolute; top: 100%; right: 0; margin-top: 5px;
            background: #111; border: 1px solid var(--primary); border-radius: 4px;
            width: 140px; display: none; flex-direction: column; z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }
        .dropdown-menu.show { display: flex; }
        
        .menu-item {
            padding: 10px; color: #ccc; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1); transition: 0.2s;
        }
        .menu-item:hover { background: var(--primary); color: #000; }
        .menu-item:last-child { border-bottom: none; }

        /* GRINDER PANEL (OVERLAY) */
        #grinder-panel {
            position: absolute; top: 65px; left: 0; width: 100%; height: calc(100% - 65px);
            background: rgba(10, 15, 20, 0.98); z-index: 50; display: none;
            flex-direction: column; padding: 15px; box-sizing: border-box;
            backdrop-filter: blur(5px); overflow-y: auto;
        }
        #grinder-panel.active { display: flex; }

        .grinder-header {
            font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.1em;
            color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 10px;
            display: flex; justify-content: space-between;
        }

        .stat-row {
            display: flex; justify-content: space-between; margin-bottom: 8px;
            font-size: 0.9em; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px;
        }
        .stat-val.gold { color: var(--gold); }
        
        .bonus-list {
            margin-top: 10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px;
            font-size: 0.8em; color: #ccc;
        }
        .bonus-item { color: var(--primary); margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }

        /* CONTENT */
        #content { padding: 10px; flex: 1; overflow-y: auto; scrollbar-width: thin; }
        .route-box { background: rgba(3, 169, 244, 0.1); border: 1px dashed var(--accent); border-radius: 6px; padding: 5px; margin-bottom: 6px; text-align: center; }
        .route-name { font-family: 'Rajdhani', sans-serif; font-size: 0.95em; font-weight: 700; color: #fff; }
        
        .status-container { background: rgba(255,255,255,0.05); border-radius: 6px; padding: 4px; margin-bottom: 10px; text-align: center; display: flex; flex-direction: column; gap: 2px; }
        .status-line { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.8em; color: #ccc; text-transform: uppercase; }
        .timer-line { font-family: 'Rajdhani', sans-serif; font-weight: 900; font-size: 1.1em; color: var(--text-dim); }
        .timer-line.active { color: var(--green); }
        .timer-line.urgent { color: var(--red); }

        .section { margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .label { font-size: 0.7em; color: var(--text-dim); text-transform: uppercase; margin-bottom: 2px; }
        .value { font-size: 1.1em; font-weight: bold; color: var(--text-main); }
        .value.highlight { color: var(--primary); }
        
        .progress-container { position: relative; height: 14px; background: rgba(0,0,0,0.5); border-radius: 4px; margin: 4px 0 4px 0; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.65em; font-weight: bold; z-index: 2; }

        .inv-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 4px 8px; margin-bottom: 4px; border-radius: 4px; border-left: 3px solid var(--text-dim); }
        .inv-row.low-stock { border-left-color: var(--red); background: rgba(255, 82, 82, 0.1); }

        /* Calculator */
        input[type="number"] { width: 90%; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; padding: 4px; border-radius: 4px; margin-top: 4px; font-family: inherit; font-size: 0.9em; }
        .quick-btn-row { display: flex; gap: 5px; margin-top: 5px; justify-content: center; }
        .quick-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #ccc; font-size: 0.7em; padding: 2px 6px; border-radius: 3px; cursor: pointer; flex: 1; }
        .quick-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        #resize-handle { position: absolute; bottom: 0; right: 0; width: 15px; height: 15px; cursor: nwse-resize; }
    </style>
</head>
<body>

<div id="tracker-app">
    <div id="micro-view" onmousedown="dragStart(event)">
        <button class="micro-btn" onclick="window.toggleMini()">EXPAND</button>
        <div class="micro-row" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div class="micro-group"><span style="font-size:1.2em">‚úàÔ∏è</span><span class="micro-val" id="micro-status">IDLE</span><span class="micro-val" id="micro-timer">--</span></div>
            <div class="micro-group"><span class="micro-label">To:</span><span class="micro-val" id="micro-dest">--</span></div>
            <div class="micro-group"><span class="micro-label">üç±</span><span class="micro-val" id="micro-meal">0</span></div>
        </div>
        <div class="micro-row">
            <div class="micro-group" style="width:100%"><span class="micro-label">Lvl</span><span class="micro-val highlight" id="micro-level">0</span><div class="micro-progress-bg" style="flex:1"><div class="micro-progress-fill" id="micro-bar"></div></div></div>
        </div>
    </div>

    <header id="drag-handle" onmousedown="dragStart(event)">
        <div class="header-controls"><a href="#" class="nav-icon">üè†</a></div>
        <div class="header-title">AIRLINE OPS</div>
        <div id="user-name-fly">Pilot ...</div>

        <div class="menu-container">
            <button class="burger-btn" onclick="toggleMenu()">‚ò∞</button>
            <div class="dropdown-menu" id="main-menu">
                <div class="menu-item" onclick="window.toggleMini()">üóñ Mini Mode</div>
                <div class="menu-item" onclick="toggleGrinder()">üìà Grinder Stats</div>
                <div class="menu-item" onclick="resetSession()">üîÑ Reset Session</div>
            </div>
        </div>
    </header>

    <div id="grinder-panel">
        <div class="grinder-header">
            <span>BXP TOKEN TRACKER</span>
            <span style="color:#aaa; font-size:0.7em">PILOTING</span>
        </div>

        <div class="stat-row">
            <span class="label">Session Earned</span>
            <span class="stat-val gold" id="g-session">0</span>
        </div>
        <div class="stat-row">
            <span class="label">Avg Per Flight</span>
            <span class="stat-val" id="g-avg">0</span>
        </div>
        <div class="stat-row">
            <span class="label">Est. Per Hour</span>
            <span class="stat-val highlight" id="g-ph">0</span>
        </div>
        <div class="stat-row">
            <span class="label">Start Balance</span>
            <span class="stat-val" id="g-start">0</span>
        </div>

        <div class="grinder-header" style="margin-top:15px; color:var(--primary)">
            <span>ACTIVE BONUSES</span>
        </div>
        <div class="bonus-list" id="bonus-container">
            <div style="font-style:italic; opacity:0.5; font-size:0.8em">Open 'Identity' menu in-game to scan...</div>
        </div>
        
        <div style="margin-top:auto; text-align:center;">
            <button class="quick-btn" onclick="toggleGrinder()">CLOSE PANEL</button>
        </div>
    </div>

    <div id="content">
        <div class="route-box">
            <div style="font-size:0.6em; color:var(--accent);">DESTINATION</div>
            <div class="route-name" id="disp-route-name">Waiting for route...</div>
            <div style="font-size:0.75em; color:#aaa;" id="disp-dist">Dist: -/-</div>
        </div>

        <div class="status-container">
            <div class="status-line" id="disp-status">IDLE</div>
            <div class="timer-line" id="disp-timer">--</div>
        </div>

        <div class="section">
            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                <div><div class="label">Pilot Level</div><div class="value highlight" style="font-size:1.6em" id="disp-level">...</div></div>
                <div style="text-align:right;"><div class="label">XP</div><div class="value" id="disp-xp" style="font-size:0.9em">0</div></div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="level-bar"></div>
                <div class="progress-text" id="level-text">0%</div>
            </div>
            <div class="xp-remaining-text" id="disp-xp-remaining" style="text-align:center; font-size:0.75em; color:#aaa; margin-bottom:5px;"></div>
        </div>

        <div class="section">
            <div class="label">Inventory</div>
            <div class="inv-row" id="row-meal">
                <div style="font-size:0.85em">üç± Airline Meals</div>
                <div style="font-weight:bold" id="stock-meal">0</div>
            </div>
        </div>

        <div class="section" style="border:none;">
            <div class="label">Calculator</div>
            <input type="number" id="target-input" placeholder="Target XP">
            <div class="quick-btn-row">
                <button class="quick-btn" onclick="window.setCalc(100000)">100K</button>
                <button class="quick-btn" onclick="window.setCalc(1000000)">1M</button>
            </div>
            <div class="calc-output" id="calc-result"></div>
        </div>
    </div>

    <div id="resize-handle"></div>
</div>

<script>
// --- CONFIGURATION ---
const JOB_EXP_KEY = "exp_piloting_piloting";
const JOB_BXP_KEY_TOKEN = "exp_token_a|piloting|piloting"; // Bonus Pool
const JOB_BXP_KEY_PHYSICAL = "exp_token|piloting|piloting"; // Item Token
const ITEM_MEAL = "fridge_airline_meal";

const STORAGE_KEY_CALC = "tt_air_calc_v1";
const STORAGE_KEY_MINI = "tt_air_mini_v1";

// --- STATE ---
const STATE = {
    currentXP: 0, startXP: null,
    startTokens: null, currentTokens: 0,
    runs: 0,
    startTime: Date.now(),
    isDeboarding: false
};

// --- UI HELPERS ---
function toggleMenu() {
    document.getElementById('main-menu').classList.toggle('show');
}
// Close menu when clicking outside
window.onclick = function(e) {
    if (!e.target.matches('.burger-btn')) {
        document.getElementById('main-menu').classList.remove('show');
    }
}

function toggleGrinder() {
    document.getElementById('grinder-panel').classList.toggle('active');
    document.getElementById('main-menu').classList.remove('show');
}

function resetSession() {
    STATE.startXP = STATE.currentXP;
    STATE.startTokens = STATE.currentTokens;
    STATE.runs = 0;
    STATE.startTime = Date.now();
    document.getElementById('main-menu').classList.remove('show');
    updateGrinderUI(0);
}

window.toggleMini = function() {
    const app = document.getElementById('tracker-app');
    app.classList.toggle('mini-mode');
    const isMini = app.classList.contains('mini-mode');
    localStorage.setItem(STORAGE_KEY_MINI, isMini);
    document.getElementById('main-menu').classList.remove('show');
};

const savedMini = localStorage.getItem(STORAGE_KEY_MINI);
if (savedMini === "true") document.getElementById('tracker-app').classList.add('mini-mode');

const savedCalc = localStorage.getItem(STORAGE_KEY_CALC);
if (savedCalc) document.getElementById('target-input').value = savedCalc;

window.setCalc = function(val) {
    document.getElementById('target-input').value = val;
    runCalculator();
};

// --- DATA ENGINE ---
window.addEventListener('message', (event) => {
    let d = event.data;
    if (d && d.type === 'data' && d.data) d = d.data;
    if (!d) return;

    // 1. Status Parsing (Flight State)
    if (d.status) {
        try {
            let statusData = (typeof d.status === 'string') ? JSON.parse(d.status) : d.status;
            let lines = statusData.lines || [];
            
            if (lines[0]) {
                let clean = lines[0].replace(/~[a-z]~/g, "").replace("Status:", "").trim();
                let timer = clean.match(/\((\d+)\s*s\)/i);
                
                // Flight counting logic
                if (clean.toUpperCase().includes("DE-BOARDING")) STATE.isDeboarding = true;
                else if (STATE.isDeboarding) {
                    STATE.runs++;
                    STATE.isDeboarding = false;
                }

                document.getElementById('disp-status').innerText = clean.split('(')[0].trim();
                document.getElementById('micro-status').innerText = clean.split('(')[0].trim().substring(0, 8);
                
                if(timer) {
                    document.getElementById('disp-timer').innerText = timer[1] + "s";
                    document.getElementById('micro-timer').innerText = timer[1] + "s";
                } else {
                    document.getElementById('disp-timer').innerText = "--";
                    document.getElementById('micro-timer').innerText = "";
                }
            }
            if (lines[1]) {
                let dest = lines[1].replace(/~[a-z]~/g, "").replace("Destination:", "").trim();
                document.getElementById('disp-route-name').innerText = dest;
                document.getElementById('micro-dest').innerText = dest.substring(0, 10);
            }
            if (lines[2]) {
                document.getElementById('disp-dist').innerText = lines[2].replace(/~[a-z]~/g, "");
            }
        } catch(e){}
    }

    // 2. XP & Level
    let xp = d[JOB_EXP_KEY];
    if (typeof xp === 'number') {
        if (STATE.startXP === null) STATE.startXP = xp;
        STATE.currentXP = xp;
        
        let lvl = getLevelInfo(xp);
        let pct = Math.min(100, Math.max(0, ((lvl.expInLevel / lvl.expForNext) * 100))).toFixed(1);
        
        document.getElementById('disp-level').innerText = lvl.level;
        document.getElementById('micro-level').innerText = lvl.level;
        document.getElementById('disp-xp').innerText = formatNumber(xp);
        document.getElementById('level-bar').style.width = pct + "%";
        document.getElementById('level-text').innerText = pct + "%";
        document.getElementById('micro-bar').style.width = pct + "%";
        
        let needed = Math.round(lvl.expForNext - lvl.expInLevel);
        document.getElementById('disp-xp-remaining').innerHTML = `<b>${formatNumber(needed)}</b> XP to Next Level`;
        
        runCalculator();
    }

    // 3. Grinder Stats (Tokens)
    let tokens = d[JOB_BXP_KEY_BONUS]; // Pool
    if(!tokens) tokens = d[JOB_BXP_KEY_PHYSICAL]; // Item
    // Check inventory if not in root
    if (!tokens && d.inventory) {
        try {
            let inv = JSON.parse(d.inventory);
            tokens = inv[JOB_BXP_KEY_BONUS] || inv[JOB_BXP_KEY_PHYSICAL];
        } catch(e){}
    }

    if (tokens) {
        let val = (typeof tokens === 'object') ? tokens.amount : tokens;
        if(STATE.startTokens === null) STATE.startTokens = val;
        STATE.currentTokens = val;
        updateGrinderUI(val);
    }

    // 4. Inventory (Meals)
    let meals = 0;
    // Check main inv + trunk logic would go here similar to prev versions
    // Simplified for this snippet:
    if(d.inventory) {
        try {
            let inv = JSON.parse(d.inventory);
            let m = inv[ITEM_MEAL];
            if(m) meals += (m.amount || m);
        } catch(e){}
    }
    document.getElementById('stock-meal').innerText = meals;
    document.getElementById('micro-meal').innerText = meals;
    if(meals < 5) document.getElementById('row-meal').classList.add('low-stock');
    else document.getElementById('row-meal').classList.remove('low-stock');

    // 5. Active Bonus Scan
    if (d.menu_choices) {
        try {
            let menu = JSON.parse(d.menu_choices);
            let identityHtml = menu.find(m => m[0] === "Identity")?.[1];
            if (identityHtml) parseBonuses(identityHtml);
        } catch(e) {}
    }
});

function updateGrinderUI(currentVal) {
    let earned = currentVal - STATE.startTokens;
    if(earned < 0) { STATE.startTokens = currentVal; earned = 0; } // Reset if spent

    document.getElementById('g-session').innerText = formatNumber(earned);
    document.getElementById('g-start').innerText = formatNumber(STATE.startTokens);

    let avg = STATE.runs > 0 ? Math.round(earned / STATE.runs) : 0;
    document.getElementById('g-avg').innerText = formatNumber(avg);

    let mins = (Date.now() - STATE.startTime) / 60000;
    if(mins > 1) {
        let ph = Math.round((earned / mins) * 60);
        document.getElementById('g-ph').innerText = formatNumber(ph);
    }
}

function parseBonuses(html) {
    const container = document.getElementById('bonus-container');
    // Only update if content changed to prevent flicker, logic omitted for brevity
    container.innerHTML = ""; 
    const lines = html.split('<br/>');
    let found = false;
    lines.forEach(line => {
        let text = line.replace(/<[^>]*>/g, '').trim();
        if ((text.includes("Exp Bonus") || text.includes("Premium") || text.includes("Skill of the Day")) && !text.includes("Expires")) {
            let div = document.createElement('div');
            div.className = 'bonus-item';
            div.innerText = "‚òÖ " + text;
            container.appendChild(div);
            found = true;
        }
    });
    if (!found) container.innerHTML = "<div style='opacity:0.5;font-size:0.8em'>No active bonuses found.</div>";
}

function getLevelInfo(exp) {
    let level = 0, xpCap = 5;
    while (exp >= xpCap) { exp -= xpCap; level++; xpCap = (level + 1) * 5; }
    return { level, expInLevel: exp, expForNext: xpCap };
}

function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(2) + "M";
    if (num >= 1000) return (num / 1000).toFixed(1) + "K";
    return num.toLocaleString();
}

function runCalculator() {
    const val = document.getElementById('target-input').value;
    const el = document.getElementById('calc-result');
    localStorage.setItem(STORAGE_KEY_CALC, val);
    if (!val) { el.innerText = ""; return; }
    
    let inputVal = parseInt(val.replace(/,/g, ''));
    let targetXP = inputVal;
    if (inputVal < 200) { 
         let lvlXP = 0; 
         for(let i=0; i<inputVal; i++) lvlXP += (5 * i * (i + 1)) / 2;
         targetXP = (5 * inputVal * (inputVal + 1)) / 2;
    }

    if (targetXP > STATE.currentXP) {
        const diff = targetXP - STATE.currentXP;
        el.innerHTML = `Need: <b>${formatNumber(diff)} XP</b>`;
    } else {
        el.innerHTML = `Target Reached!`;
    }
}

// Request Data Loop
setInterval(() => {
    if(window.parent) window.parent.postMessage({ type: "getData" }, "*");
}, 1000);

// Drag Logic
const elm = document.getElementById("tracker-app");
const head = document.getElementById("drag-handle");
const micro = document.getElementById("micro-view");
let isDragging = false, startX, startY, initLeft, initTop;

const startDrag = (e) => {
    if(e.target.closest('button') || e.target.closest('input') || e.target.closest('a')) return;
    e.preventDefault(); isDragging = true;
    startX = e.clientX; startY = e.clientY;
    initLeft = elm.getBoundingClientRect().left;
    initTop = elm.getBoundingClientRect().top;
    document.addEventListener("mousemove", dragMove);
    document.addEventListener("mouseup", dragEnd);
};
const dragMove = (e) => {
    if(!isDragging) return;
    elm.style.left = (initLeft + e.clientX - startX) + "px";
    elm.style.top = (initTop + e.clientY - startY) + "px";
};
const dragEnd = () => {
    isDragging = false;
    document.removeEventListener("mousemove", dragMove);
    document.removeEventListener("mouseup", dragEnd);
};
head.addEventListener("mousedown", startDrag);
micro.addEventListener("mousedown", startDrag);

// Resize Logic
const rh = document.getElementById('resize-handle');
rh.addEventListener('mousedown', (e) => {
    e.preventDefault();
    window.addEventListener('mousemove', resize);
    window.addEventListener('mouseup', stopResize);
});
function resize(e) {
    if(elm.classList.contains('mini-mode')) return;
    elm.style.width = Math.max(280, e.clientX - elm.getBoundingClientRect().left) + 'px';
    elm.style.height = Math.max(250, e.clientY - elm.getBoundingClientRect().top) + 'px';
}
function stopResize() {
    window.removeEventListener('mousemove', resize);
    window.removeEventListener('mouseup', stopResize);
}
</script>
</body>
</html>
