<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pinki's Hunting & Fishing Calc</title>
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Roboto:wght@400;700&display=swap');

        :root {
            --bg-body: #121214;
            --bg-panel: rgba(30, 30, 35, 0.95);
            --primary: #ff4081; /* Pinki Pink */
            --primary-dim: #c60055;
            --accent: #00e676; /* Green for results */
            --text-main: #ffffff;
            --text-dim: #aaaaaa;
            --border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: transparent;
            color: var(--text-main);
            overflow: hidden;
            height: 100vh; width: 100vw;
            user-select: none;
        }

        #app {
            position: absolute; top: 50px; left: 50px;
            width: 850px; height: 600px;
            background: var(--bg-body);
            border-radius: 12px;
            border: 1px solid var(--primary);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            height: 50px; background: linear-gradient(90deg, #1f1f1f, #2a2a2a);
            border-bottom: var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; cursor: move;
        }
        .app-title { font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.4em; letter-spacing: 1px; color: var(--primary); text-transform: uppercase; }
        .nav-home { font-size: 1.5em; text-decoration: none; color: var(--text-dim); transition: 0.2s; }
        .nav-home:hover { color: #fff; transform: scale(1.1); }

        /* LAYOUT */
        .main-content { display: flex; flex: 1; overflow: hidden; }
        
        /* SIDEBAR (MULTIPLIERS) */
        .sidebar {
            width: 260px; background: rgba(0,0,0,0.2);
            border-right: var(--border);
            padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .section-title { font-family: 'Rajdhani', sans-serif; font-weight: 700; color: var(--primary); text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; margin-bottom: 5px; }

        .boost-row { display: flex; align-items: center; justify-content: space-between; font-size: 0.9em; margin-bottom: 4px; }
        .boost-label { color: #ccc; }
        input[type="checkbox"] { accent-color: var(--primary); transform: scale(1.2); cursor: pointer; }

        .perk-input { width: 100%; background: #222; border: 1px solid #444; color: #fff; padding: 5px; border-radius: 4px; text-align: center; font-weight: bold; margin-bottom: 10px; }

        .total-mult-box {
            background: rgba(0, 230, 118, 0.1); border: 1px solid var(--accent);
            padding: 10px; border-radius: 6px; text-align: center; margin-top: 10px;
        }
        .mult-val { font-size: 1.8em; font-weight: 900; color: var(--accent); font-family: 'Rajdhani', sans-serif; }

        /* MAIN PANEL */
        .workspace { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }

        /* GOAL SECTION */
        .goal-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-size: 0.8em; color: var(--text-dim); text-transform: uppercase; font-weight: bold; }
        .std-input { background: #2a2a2a; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.1em; font-weight: bold; }
        .std-input:focus { border-color: var(--primary); outline: none; }
        
        .sync-btn { background: var(--primary-dim); border: none; color: #fff; padding: 5px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-top: 2px; transition: 0.2s; }
        .sync-btn:hover { background: var(--primary); }

        /* TABS */
        .mode-tabs { display: flex; border-bottom: var(--border); margin-bottom: 15px; }
        .mode-tab { flex: 1; text-align: center; padding: 10px; background: rgba(0,0,0,0.2); color: #888; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.1em; text-transform: uppercase; transition: 0.2s; }
        .mode-tab.active { background: var(--primary); color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .mode-tab:hover:not(.active) { background: rgba(255,255,255,0.05); color: #fff; }

        .calc-panel { display: none; }
        .calc-panel.active { display: block; }

        /* RESULTS TABLE */
        .result-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-top: 15px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px; }
        .result-row.highlight { color: var(--accent); font-weight: bold; font-size: 1.1em; border: none; }
        .res-label { color: #aaa; }
        .res-val { font-weight: bold; font-family: 'Rajdhani', sans-serif; }

        /* FOOTER */
        .support-footer { padding: 10px; text-align: center; background: rgba(0,0,0,0.3); border-top: var(--border); font-size: 0.8em; }
        .support-link { color: var(--text-dim); text-decoration: none; cursor: pointer; transition: 0.3s; }
        .support-link:hover { color: #fff; }
        .heart { color: var(--primary); display: inline-block; animation: beat 1s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

    </style>
</head>
<body>

    <div id="app">
        <header id="drag-handle">
            <a href="https://pinkiprim.github.io/pinkiapps.html" class="nav-home">üè†</a>
            <div class="app-title">Hunting & Fishing Calculator</div>
            <div style="width:24px"></div> </header>

        <div class="main-content">
            <div class="sidebar">
                <div class="section-title">Active Multipliers</div>
                
                <div class="boost-row"><span class="boost-label">Discord Account (5%)</span><input type="checkbox" class="boost-cb" value="5" checked></div>
                <div class="boost-row"><span class="boost-label">Faction Bonus (5%)</span><input type="checkbox" class="boost-cb" value="5"></div>
                <div class="boost-row"><span class="boost-label">Discord Voice (10%)</span><input type="checkbox" class="boost-cb" value="10"></div>
                <div class="boost-row"><span class="boost-label">Airline Perk (5%)</span><input type="checkbox" class="boost-cb" value="5"></div>
                <div class="boost-row"><span class="boost-label">Monke Perm (25%)</span><input type="checkbox" class="boost-cb" value="25"></div>
                
                <div style="margin: 10px 0; border-top:1px solid #333; padding-top:10px;">
                    <div class="boost-label" style="margin-bottom:5px;">Skill Perks Obtained (0-19)</div>
                    <input type="number" id="perk-count" class="perk-input" min="0" max="19" value="0" oninput="calc()">
                    <div style="font-size:0.7em; color:#666;">First: 5%, Rest: 2.5% (Max 50%)</div>
                </div>

                <div class="section-title" style="margin-top:10px;">Consumable Token</div>
                <select id="token-select" class="perk-input" style="text-align:left;" onchange="calc()">
                    <option value="0|0">None</option>
                    <option value="15|60">15% - 1 Hour</option>
                    <option value="10|90">10% - 90 Mins</option>
                    <option value="5|10080">5% - 1 Week</option>
                    <option value="10|1440">10% - 1 Day</option>
                    <option value="5|120">5% - 2 Hours</option>
                </select>

                <div class="total-mult-box">
                    <div style="font-size:0.8em; color:#aaa; text-transform:uppercase;">Total Multiplier</div>
                    <div class="mult-val" id="disp-mult">1.00x</div>
                </div>
            </div>

            <div class="workspace">
                
                <div class="section-title">XP Goals</div>
                <div class="goal-grid">
                    <div class="input-group">
                        <label>Current XP</label>
                        <input type="number" id="current-xp" class="std-input" value="0" oninput="calc()">
                        <button class="sync-btn" onclick="requestSync()">üîÑ Fetch from Game</button>
                    </div>
                    <div class="input-group">
                        <label>Target Level</label>
                        <input type="number" id="target-lvl" class="std-input" placeholder="e.g. 100" oninput="lvlToXp()">
                    </div>
                    <div class="input-group">
                        <label>OR Target XP</label>
                        <input type="number" id="target-xp" class="std-input" placeholder="Total XP needed" oninput="calc()">
                    </div>
                </div>
                <div style="text-align:right; font-family:'Rajdhani'; font-size:1.2em; color:#fff;">
                    REMAINING: <span id="disp-remaining" style="color:var(--primary); font-weight:bold;">0</span> XP
                </div>

                <div class="mode-tabs">
                    <div class="mode-tab active" onclick="switchMode('hunting')">Hunting</div>
                    <div class="mode-tab" onclick="switchMode('fishing')">Fishing</div>
                </div>

                <div id="panel-hunting" class="calc-panel active">
                    <div class="goal-grid" style="grid-template-columns: 2fr 1fr;">
                        <div class="input-group">
                            <label>Target Animal</label>
                            <select id="animal-select" class="std-input" onchange="calc()"></select>
                        </div>
                        <div class="input-group">
                            <label>Kill Speed (Kills / Hour)</label>
                            <input type="number" id="hunt-rate" class="std-input" value="60" oninput="calc()">
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="result-row"><span class="res-label">Base XP (Per Kill)</span><span class="res-val" id="hunt-base">0</span></div>
                        <div class="result-row"><span class="res-label">Boosted XP (Per Kill)</span><span class="res-val" id="hunt-boosted" style="color:var(--primary)">0</span></div>
                        <div style="border-top:1px solid rgba(255,255,255,0.1); margin:10px 0;"></div>
                        <div class="result-row highlight"><span class="res-label">Animals Needed</span><span class="res-val" id="hunt-needed">0</span></div>
                        <div class="result-row"><span class="res-label">Estimated Time</span><span class="res-val" id="hunt-time">0h 0m</span></div>
                        <div class="result-row"><span class="res-label">Tokens Required</span><span class="res-val" id="hunt-tokens" style="color:var(--accent)">0</span></div>
                    </div>
                </div>

                <div id="panel-fishing" class="calc-panel">
                    <div class="goal-grid">
                        <div class="input-group">
                            <label>Avg Fish Weight (kg)</label>
                            <input type="number" id="fish-weight" class="std-input" value="10" oninput="calc()">
                        </div>
                        <div class="input-group">
                            <label>Tug Amount (Fish Count)</label>
                            <input type="number" id="fish-amount" class="std-input" value="1" oninput="calc()">
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="result-row"><span class="res-label">Pole XP (Per Catch)</span><span class="res-val" id="fish-pole">0</span></div>
                        <div class="result-row"><span class="res-label">Tug XP (Per Haul)</span><span class="res-val" id="fish-tug">0</span></div>
                        <div style="border-top:1px solid rgba(255,255,255,0.1); margin:10px 0;"></div>
                        <div class="result-row highlight"><span class="res-label">Pole Catches Needed</span><span class="res-val" id="pole-needed">0</span></div>
                        <div class="result-row highlight"><span class="res-label">Tug Hauls Needed</span><span class="res-val" id="tug-needed">0</span></div>
                    </div>

                    <div class="section-title" style="margin-top:20px;">Meat Exchange</div>
                    <div class="goal-grid">
                        <div class="input-group">
                            <label>Regular Meat</label>
                            <input type="number" id="meat-reg" class="std-input" placeholder="Amount" oninput="calcMeat()">
                        </div>
                        <div class="input-group">
                            <label>Premium Meat</label>
                            <input type="number" id="meat-prem" class="std-input" placeholder="Amount" oninput="calcMeat()">
                        </div>
                        <div class="input-group">
                            <label>Total XP</label>
                            <div class="std-input" id="meat-result" style="color:var(--accent)">0</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="support-footer">
            <div onclick="openExternal('https://www.paypal.com/paypalme/pinkiprim')" class="support-link">
                Support PinkiPrim <span class="heart">‚ù§</span>
            </div>
        </div>
    </div>

<script>
// --- CONFIG DATA ---
const ANIMALS = [
    {name: "Bobcat", xp: 5.0}, {name: "Brown Bear", xp: 10.0}, {name: "Leopard", xp: 8.0},
    {name: "Lion", xp: 6.5}, {name: "Wolf", xp: 5.0}, {name: "Skunk", xp: 0.5},
    {name: "Coyote", xp: 1.5}, {name: "Deer", xp: 2.0}, {name: "Cougar", xp: 2.5},
    {name: "Rabbit", xp: 1.5}, {name: "Rat", xp: 0.5}, {name: "Boar", xp: 1.5},
    {name: "Hammerhead Shark", xp: 15.0}, {name: "Tiger Shark", xp: 15.0},
    {name: "Stingray", xp: 15.0}, {name: "Humpback Whale", xp: 15.0},
    {name: "Killer Whale", xp: 15.0}, {name: "Dolphin", xp: 15.0},
    {name: "Fish", xp: 0.5}, {name: "Bird (Generic)", xp: 0.5}
];

// --- INIT ---
window.onload = function() {
    const sel = document.getElementById('animal-select');
    ANIMALS.sort((a,b) => a.name.localeCompare(b.name));
    ANIMALS.forEach(a => {
        let opt = document.createElement('option');
        opt.value = a.xp;
        opt.innerText = `${a.name} (${a.xp} XP)`;
        sel.appendChild(opt);
    });
    
    // Position Restore
    const pos = JSON.parse(localStorage.getItem('tt_huntcalc_pos'));
    if(pos) {
        document.getElementById('app').style.left = pos.left + 'px';
        document.getElementById('app').style.top = pos.top + 'px';
    }

    // Attach checkbox listeners
    document.querySelectorAll('.boost-cb').forEach(cb => {
        cb.addEventListener('change', calc);
    });

    calc();
};

function openExternal(url) {
    try { window.invokeNative('openUrl', url); } catch(e) { window.open(url, '_blank'); }
}

// --- CORE CALCULATIONS ---
function getMultiplier() {
    let base = 100; // 100% base
    
    // Checkboxes
    document.querySelectorAll('.boost-cb:checked').forEach(cb => {
        base += parseFloat(cb.value);
    });

    // Perks
    let perks = parseInt(document.getElementById('perk-count').value) || 0;
    if (perks > 0) {
        base += 5; // First perk
        if (perks > 1) base += (perks - 1) * 2.5;
    }
    if(base > (100 + 50 + 100)) {} // Cap check if needed, but logic says max 50% from perks.

    // Token
    let tokenVal = document.getElementById('token-select').value.split('|')[0];
    base += parseFloat(tokenVal);

    return base / 100;
}

function calc() {
    let mult = getMultiplier();
    document.getElementById('disp-mult').innerText = mult.toFixed(2) + "x";

    let curXP = parseFloat(document.getElementById('current-xp').value) || 0;
    let tarXP = parseFloat(document.getElementById('target-xp').value) || 0;
    
    let remXP = Math.max(0, tarXP - curXP);
    document.getElementById('disp-remaining').innerText = remXP.toLocaleString();

    // --- HUNTING ---
    let baseAnimalXP = parseFloat(document.getElementById('animal-select').value) || 0;
    let boostedAnimalXP = baseAnimalXP * mult;
    
    document.getElementById('hunt-base').innerText = baseAnimalXP.toFixed(1);
    document.getElementById('hunt-boosted').innerText = boostedAnimalXP.toFixed(2);

    let animalsNeeded = remXP > 0 ? Math.ceil(remXP / boostedAnimalXP) : 0;
    document.getElementById('hunt-needed').innerText = animalsNeeded.toLocaleString();

    // Time & Tokens
    let rate = parseFloat(document.getElementById('hunt-rate').value) || 1;
    let hoursNeeded = animalsNeeded / rate;
    
    let h = Math.floor(hoursNeeded);
    let m = Math.round((hoursNeeded - h) * 60);
    document.getElementById('hunt-time').innerText = `${h}h ${m}m`;

    let tokenData = document.getElementById('token-select').value.split('|');
    let tokenMins = parseFloat(tokenData[1]);
    
    if (tokenMins > 0 && hoursNeeded > 0) {
        let totalMins = hoursNeeded * 60;
        let tokens = Math.ceil(totalMins / tokenMins);
        document.getElementById('hunt-tokens').innerText = tokens + "x";
    } else {
        document.getElementById('hunt-tokens').innerText = "N/A";
    }

    // --- FISHING ---
    let weight = parseFloat(document.getElementById('fish-weight').value) || 0;
    let amount = parseFloat(document.getElementById('fish-amount').value) || 1;

    // Pole: max(0.1, weight / 15)
    let poleBase = Math.max(0.1, weight / 15);
    let poleBoosted = poleBase * mult;
    
    // Tug: max(0.1, weight / 20) * amount
    let tugBase = Math.max(0.1, weight / 20) * amount;
    let tugBoosted = tugBase * mult;

    document.getElementById('fish-pole').innerText = poleBoosted.toFixed(2);
    document.getElementById('fish-tug').innerText = tugBoosted.toFixed(2);

    document.getElementById('pole-needed').innerText = remXP > 0 ? Math.ceil(remXP / poleBoosted).toLocaleString() : 0;
    document.getElementById('tug-needed').innerText = remXP > 0 ? Math.ceil(remXP / tugBoosted).toLocaleString() : 0;
}

// --- LEVEL MATH ---
// Formula: Total XP = 5 * (L * (L+1)) / 2  (Sum of 5*i)
function lvlToXp() {
    let lvl = parseInt(document.getElementById('target-lvl').value);
    if (isNaN(lvl)) return;
    
    // Sum of arithmetic progression: n/2 * (2a + (n-1)d) where a=5, d=5
    // Simplified: 2.5 * L * (L+1)
    let totalXP = 2.5 * lvl * (lvl + 1);
    document.getElementById('target-xp').value = totalXP;
    calc();
}

function calcMeat() {
    let reg = parseFloat(document.getElementById('meat-reg').value) || 0;
    let prem = parseFloat(document.getElementById('meat-prem').value) || 0;
    
    let xp = (reg / 200) + (prem / 100);
    document.getElementById('meat-result').innerText = xp.toFixed(2) + " XP";
}

// --- UI TABS ---
function switchMode(mode) {
    document.querySelectorAll('.calc-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('panel-' + mode).classList.add('active');
    
    document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
}

// --- NUI BRIDGE ---
function requestSync() {
    window.parent.postMessage({ type: "getData" }, "*");
}

window.addEventListener('message', (event) => {
    const data = event.data.type === 'data' ? event.data.data : event.data;
    if (data.exp_hunting_skill || data.exp_farming_fishing) {
        // Determine which one to use based on active tab or just max?
        // Let's check hunting first
        let huntXP = data.exp_hunting_skill || 0;
        let fishXP = data.exp_farming_fishing || 0;
        
        // Simple logic: If hunting panel is open, use hunting xp, else fishing
        let isHunting = document.getElementById('panel-hunting').classList.contains('active');
        document.getElementById('current-xp').value = isHunting ? huntXP : fishXP;
        calc();
    }
});

// --- DRAG LOGIC ---
const elm = document.getElementById("app");
const header = document.getElementById("drag-handle");
let isDragging = false, startX, startY, initLeft, initTop;

header.addEventListener("mousedown", (e) => {
    if(e.target.tagName === 'A') return;
    e.preventDefault(); isDragging = true;
    startX = e.clientX; startY = e.clientY;
    const r = elm.getBoundingClientRect();
    initLeft = r.left; initTop = r.top;
    window.addEventListener("mousemove", drag);
    window.addEventListener("mouseup", stopDrag);
});

function drag(e) {
    if (!isDragging) return;
    elm.style.left = (initLeft + e.clientX - startX) + "px";
    elm.style.top = (initTop + e.clientY - startY) + "px";
}

function stopDrag() {
    isDragging = false;
    window.removeEventListener("mousemove", drag);
    window.removeEventListener("mouseup", stopDrag);
    localStorage.setItem('tt_huntcalc_pos', JSON.stringify({ left: elm.offsetLeft, top: elm.offsetTop }));
}

</script>
</body>
</html>
